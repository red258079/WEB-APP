<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Khiếu nại - Edexis</title>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.2/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/aos/2.3.4/aos.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
  <style>
    :root {
      --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      --secondary-gradient: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
      --glass-bg: rgba(255, 255, 255, 0.1);
      --glass-border: rgba(255, 255, 255, 0.2);
      --text-light: rgba(255, 255, 255, 0.9);
      --shadow-soft: 0 20px 40px rgba(0, 0, 0, 0.1);
      --shadow-hover: 0 30px 60px rgba(0, 0, 0, 0.15);
    }
    body {
      font-family: 'Poppins', sans-serif;
      background: var(--primary-gradient);
      min-height: 100vh;
      padding: 2rem;
    }
    .navbar {
      backdrop-filter: blur(20px);
      background: var(--glass-bg);
      border-bottom: 1px solid var(--glass-border);
      padding: 1rem 0;
    }
    .complaint-container {
      background: var(--glass-bg);
      backdrop-filter: blur(20px);
      border: 1px solid var(--glass-border);
      border-radius: 20px;
      padding: 3rem;
      box-shadow: var(--shadow-soft);
    }
    .complaint-container h2 {
      font-weight: 700;
      color: white;
      text-align: center;
      margin-bottom: 2rem;
    }
    .form-control, .form-select {
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid var(--glass-border);
      color: white;
      border-radius: 10px;
    }
    .form-control::placeholder {
      color: var(--text-light);
      opacity: 0.7;
    }
    .form-control:focus, .form-select:focus {
      background: rgba(255, 255, 255, 0.2);
      border-color: white;
      box-shadow: none;
    }
    .btn-gradient {
      background: var(--secondary-gradient);
      border: none;
      color: white;
      padding: 12px 30px;
      font-weight: 600;
      border-radius: 50px;
      transition: all 0.3s ease;
    }
    .btn-gradient:hover {
      transform: translateY(-3px);
      box-shadow: var(--shadow-hover);
    }
    .table {
      background: var(--glass-bg);
      border: 1px solid var(--glass-border);
      color: var(--text-light);
    }
    .table th, .table td {
      border-color: var(--glass-border);
    }
    .status-pending { color: #f093fb; }
    .status-accepted { color: #4facfe; }
    .status-rejected { color: #f5576c; }
    @media (max-width: 576px) {
      .complaint-container {
        padding: 2rem;
      }
      .complaint-container h2 {
        font-size: 1.8rem;
      }
    }
  </style>
</head>
<body>
  <!-- Navbar -->
  <nav class="navbar navbar-expand-lg">
    <div class="container">
      <a class="navbar-brand text-light" href="index.html"><i class="fas fa-graduation-cap me-2"></i>Edexis</a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav ms-auto">
          <li class="nav-item"><a class="nav-link text-light" href="index.html">Trang chủ</a></li>
          <li class="nav-item"><a class="nav-link text-light" href="student_dashboard.html">Dashboard</a></li>
          <li class="nav-item"><a class="nav-link text-light" href="logout">Đăng xuất</a></li>
        </ul>
      </div>
    </div>
  </nav>

  <!-- Complaint Section -->
  <section class="complaint-container mt-5" data-aos="fade-up">
    <h2><i class="fas fa-exclamation-circle me-2"></i>Gửi khiếu nại</h2>
    <form id="complaintForm">
      <div class="mb-3">
        <label for="examId" class="form-label text-light">Bài thi</label>
        <select class="form-select" id="examId" name="examId" required>
          <option value="">Chọn bài thi</option>
          <!-- Lấy động từ API -->
        </select>
      </div>
      <div class="mb-3">
        <label for="reason" class="form-label text-light">Lý do khiếu nại</label>
        <textarea class="form-control" id="reason" name="reason" rows="4" placeholder="Nhập lý do khiếu nại" required></textarea>
      </div>
      <div class="mb-3">
        <label for="attachment" class="form-label text-light">Tệp đính kèm (nếu có)</label>
        <input type="file" class="form-control" id="attachment" name="attachment">
      </div>
      <button type="submit" class="btn btn-gradient w-100"><i class="fas fa-paper-plane me-2"></i>Gửi khiếu nại</button>
    </form>

    <h2 class="mt-5"><i class="fas fa-list me-2"></i>Danh sách khiếu nại</h2>
    <div class="table-responsive">
      <table class="table table-hover">
        <thead>
          <tr>
            <th>Bài thi</th>
            <th>Lý do</th>
            <th>Trạng thái</th>
            <th>Phản hồi</th>
            <th>Ngày gửi</th>
          </tr>
        </thead>
        <tbody id="complaintList">
          <!-- Lấy động từ API -->
        </tbody>
      </table>
    </div>
  </section>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.2/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/aos/2.3.4/aos.js"></script>
  <script src="/client/public/js/config.js"></script>
  <script src="/client/public/js/api.js"></script>
  <script>
    AOS.init({ duration: 1000, once: true });
    document.getElementById('complaintForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const formData = new FormData();
      formData.append('examId', document.getElementById('examId').value);
      formData.append('reason', document.getElementById('reason').value);
      formData.append('attachment', document.getElementById('attachment').files[0]);

      try {
        // Sử dụng relative URL
        const response = await fetch('/api/complaints', {
          method: 'POST',
          body: formData
        });
        const data = await response.json();
        if (response.ok) {
          alert('Gửi khiếu nại thành công!');
          location.reload();
        } else {
          alert(data.message || 'Gửi khiếu nại thất bại!');
        }
      } catch (err) {
        alert('Lỗi kết nối server!');
      }
    });

    // Load danh sách bài thi và khiếu nại (giả lập)
    async function loadData() {
      // Lấy danh sách bài thi
      // Sử dụng relative URL
      const examResponse = await fetch('/api/exams');
      const exams = await examResponse.json();
      const examSelect = document.getElementById('examId');
      exams.forEach(exam => {
        const option = document.createElement('option');
        option.value = exam.exam_id;
        option.textContent = exam.title;
        examSelect.appendChild(option);
      });

      // Lấy danh sách khiếu nại
      // Sử dụng relative URL
      const complaintResponse = await fetch('/api/complaints');
      const complaints = await complaintResponse.json();
      const complaintList = document.getElementById('complaintList');
      complaints.forEach(c => {
        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${c.exam_title}</td>
          <td>${c.reason}</td>
          <td class="status-${c.status}">${c.status}</td>
          <td>${c.response || 'Chưa có'}</td>
          <td>${new Date(c.created_at).toLocaleDateString()}</td>
        `;
        complaintList.appendChild(row);
      });
    }
    // loadData(); // Gỡ comment khi có API
  </script>
</body>
</html>